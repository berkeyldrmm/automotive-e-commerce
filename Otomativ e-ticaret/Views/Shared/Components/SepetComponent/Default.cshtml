@model List<Tuple<Urun,int>>
@if(Model.Count!=0){
    foreach(var urun in Model){
        <div class="d-grid mt-2" style="border:5px solid grey; border-radius:8px; padding:15px">
            <div class="body row align-items-center">
                <div class="col-3">
                    <img src="~/@urun.Item1.GorselUrl" height="150"/>
                </div>
                <div class="col-4">
                    <div class="mb-3">
                        @urun.Item1.UrunAdi
                    </div>
                    <div>
                        @urun.Item1.Marka, @urun.Item1.Kategori
                    </div>
                </div>
                <div class="col-2 sepetmiktar">
                    <span>
                        <a class="minus" href="https://localhost:7121/sepet/sepeturunmiktarazalt/@urun.Item1.UrunId"><i class="fa fa-minus" aria-hidden="true"></i></a>
                    </span>
                    <span style="background-color:#252525;color:aliceblue;text-align:center;padding:3px" class="mx-2">
                        @urun.Item2
                    </span>
                    <span>
                        <a class="plus" href="https://localhost:7121/sepet/sepeturunmiktararttir/@urun.Item1.UrunId"><i class="fa fa-plus" aria-hidden="true"></i></a>
                    </span>
                </div>
                <div class="col-2">
                    @(urun.Item1.Fiyat * @urun.Item2) TL
                </div>
                <div class="col-1">
                    <a class="delete" href="https://localhost:7121/sepet/sepeturunsil/@urun.Item1.UrunId"><img src="~/images/cop.png" width="40" /></a>
                </div>
            </div>
        </div>
    }
    <div id="siparisozet" class="d-grid" style="border-radius:8px; padding:15px">
        <div class="body row" style="border:3px solid #252525">
            <div class="col-5 p-5 m-3">
                <div>
                    Siparis Özeti
                </div>
            </div>
            <div class="col-2 p-5 m-3">
                @{
                    double toplamtutar2 = 0;
                    foreach (var prd in Model)
                    {
                        toplamtutar2 += Convert.ToDouble(prd.Item1.Fiyat * prd.Item2);
                    }

                }
                @toplamtutar2 TL
            </div>
            <div class="col-2 p-5 m-3">
                <button class="btn btn-primary siparisver">Siparis Ver</button>
            </div>
            <div class="col-1 p-5 m-3" style="font-size:10px;">
                <a href="https://localhost:7121/sepet/sepetbosalt" class="btn btn-danger sepetibosalt">Sepeti Boşalt</a>
            </div>
        </div>
    </div>
}
else{
    <div class="alert-warning w-100 text-center">
        Sepet boş
    </div>
}


<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>

    $(".delete").click(e => {
        let products;
        if (localStorage.getItem("sepet") === null) {
            products = [];
        }
        else {
            products = JSON.parse(localStorage.getItem("sepet"));
        }
        for (i = 0; i < products.length; i++) {
            if (products[i].UrunId == e.target.parentNode.getAttribute("data-id")) {
                products.splice(i, 1);
                break;
            }
        }
        localStorage.setItem("sepet", JSON.stringify(products));
        
        var url = "https://localhost:7121/sepet/index";
        if (products != []) {
            for (i = 0; i < products.length; i++) {
                if (i == 0) {
                    url += "?";
                }
                else {
                    url += "&";
                }
                url += "id" + (i + 1) + "=" + products[i].UrunId + "&" + "miktar" + (i + 1) + "=" + products[i].UrunAdedi;
            }
        }
        window.location.href = url;
    });

    $(".minus").click(e => {
        let products;
        if (localStorage.getItem("sepet") === null) {
            products = [];
        }
        else {
            products = JSON.parse(localStorage.getItem("sepet"));
        }
        for(i=0;i<products.length;i++){
            if (products[i].UrunId == e.target.parentNode.getAttribute("data-id")) {
                if(products[i].UrunAdedi!=1){
                    products[i].UrunAdedi--;
                    break;
                }
                else{

                }
            }
        }
        localStorage.setItem("sepet", JSON.stringify(products));
        var url = "https://localhost:7121/sepet/index";
        if (products != []) {
            for (i = 0; i < products.length; i++) {
                if (i == 0) {
                    url += "?";
                }
                else {
                    url += "&";
                }
                url += "id" + (i + 1) + "=" + products[i].UrunId + "&" + "miktar" + (i + 1) + "=" + products[i].UrunAdedi;
            }
        }
        window.location.href = url;
    });

    $(".plus").click(e => {
        let products;
        if (localStorage.getItem("sepet") === null) {
            products = [];
        }
        else {
            products = JSON.parse(localStorage.getItem("sepet"));
        }
        for(i=0;i<products.length;i++){
            if (products[i].UrunId == e.target.parentNode.getAttribute("data-id")) {
                products[i].UrunAdedi++;
                break;
            }
        }
        localStorage.setItem("sepet",JSON.stringify(products));
        var url = "https://localhost:7121/sepet/index";
        if (products != []) {
            for (i = 0; i < products.length; i++) {
                if (i == 0) {
                    url += "?";
                }
                else {
                    url += "&";
                }
                url += "id" + (i + 1) + "=" + products[i].UrunId + "&" + "miktar" + (i + 1) + "=" + products[i].UrunAdedi;
            }
        }
        window.location.href = url;
    });

    $(".minus").each(button=>{
        console.log($(this).attr("data-id"));
        let products;
        if (localStorage.getItem("sepet") === null) {
            products = [];
        }
        else {
            products = JSON.parse(localStorage.getItem("sepet"));
        }
        for(i=0;i<products.length;i++){
            if (products[i].UrunId == $(this).attr("data-id")) {
                if(products[i].UrunAdedi==1){
                    console.log(products[i].UrunId)
                    button.disabled=true;
                }
                break;
            }
        }
    });
</script>